
| ID      | Название                                   | Описание (что и зачем)                                                                 | Метрика/Порог                                                                 | Проверка (чем/где)                                   | Компонент     | Приоритет |
|---------|--------------------------------------------|----------------------------------------------------------------------------------------|-------------------------------------------------------------------------------|-------------------------------------------------------|--------------|-----------|
| NFR-01  | Обязательный идентификатор пользователя    | Любой запрос к доменным эндпойнтам требует `X-User-Id`.                                | 100% запросов без `X-User-Id` получают 401/403                               | PyTest негативные кейсы; логи CI                      | API (deps)    | P1        |
| NFR-02  | Авторизация owner/admin                    | Доступ к чужим объектам запрещён, роль `admin` видит всё.                              | 100% проверок owner/admin на CRUD                                             | PyTest (happy/negative), ручная выборка               | API (routers) | P1        |
| NFR-03  | Валидация входных данных                   | Поля item валидируются по диапазонам/форматам.                                         | impact/effort ∈ [1..10], title 1..120                                        | PyTest на 422; схемы Pydantic                         | API (schemas) | P1        |
| NFR-04  | Структурированные ошибки                   | Все ошибки возвращаются в едином JSON-формате.                                         | 100% 4xx/5xx соответствуют формату                                            | PyTest на 404/422; ручная проверка Swagger            | API           | P1        |
| NFR-05  | Отсутствие секретов в репозитории          | Ключи/пароли не коммитим.                                                              | 0 срабатываний детекторов на PR                                               | pre-commit `detect-private-key` в CI (зелёный шаг)    | Репозиторий   | P1        |
| NFR-06  | Актуальные зависимости (vulns=0 High/Crit) | Библиотеки без High/Critical уязвимостей.                                              | pip-audit: High/Critical = 0                                                  | (опц.) `pip-audit` в CI/локально, скриншот в PR       | Зависимости   | P2        |
| NFR-07  | Журналы операций                           | Создание/обновление/удаление пишем в лог с временем и пользователем.                   | 100% write-операций логируются на уровне INFO                                 | Ручная проверка логов / unit-тест логгера             | API           | P2        |
| NFR-08  | Rate limiting для write                    | Защита от флуда на POST/PATCH/DELETE.                                                  | ≤ 30 req/min на пользователя (dev-минимум)                                    | Интеграционный тест/конфиг                            | API           | P3        |
| NFR-09  | CORS по allow-list                         | Только доверенные origin (по переменной окружения).                                    | Все запросы с неразрешённых origin отклоняются                                 | Ручная проверка/интеграционный тест                   | API           | P3        |
| NFR-10  | Права на файл БД                           | Файл `app.db` доступен только пользователю процесса.                                   | chmod 0600 (или эквивалент на Windows)                                        | Скрипт/ручная проверка `stat`                         | Хранилище     | P3        |
| NFR-11  | Политики исходящих HTTP                    | Таймауты/ретраи/лимиты для исходящих HTTP, fail-fast и контроль нагрузки.              | timeout ≤ 5s total; retries ≤ 2; backoff 0.1→0.4s; лимит на хост             | Юнит-тесты на таймаут/ретраи; логи/метрики            | API/Utils     | P2        |
