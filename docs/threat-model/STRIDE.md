# STRIDE - Угрозы и контроли

| Поток/Элемент     | Угроза (S/T/R/I/D/E) | Описание кратко                    | Контроль/мера                                                         | Ссылка на NFR  | Проверка/Артефакт                    | Приоритет |
|-------------------|----------------------|------------------------------------|------------------------------------------------------------------------|----------------|--------------------------------------|-----------|
| F1 POST /items    | T (Tampering)        | Подмена/инъекции в payload         | Валидация схемой + типы, лимиты полей, очистка labels                 | NFR-07, NFR-02 | pytest негативные кейсы, ruff/black  | High      |
| F1 POST /items    | R (Repudiation)      | Отрицание действий                 | Структурный лог: кто/что/когда (owner_id, метод, статус)              | NFR-03         | Логи (sample), проверка формата      | Medium    |
| F2 GET /items     | I (Info Disclosure)  | Утечка чужих данных                | Явная фильтрация по owner_id для user; admin видит всё                | NFR-01         | unit-тесты на 403/фильтрацию         | High      |
| F2 GET /items     | D (DoS)              | Спам-запросы                       | Rate limit + пагинация limit ≤ 100                                    | NFR-04         | e2e + конфиг лимита, лог метрик      | Medium    |
| F3 GET /items/{id}| S/R                  | Чтение без прав/отрицание          | Проверка role/owner, аудит чтения                                     | NFR-01, NFR-03 | pytest (admin/user), логи            | High      |
| F4 PATCH /items   | T                    | Нелегитимные правки                | Контроль владельца/роли, валидация patch                              | NFR-01, NFR-07 | unit-тесты patch                     | High      |
| F5 DELETE /items  | T/R                  | Удаление без прав / отрицание      | Проверка роли/владельца, лог действий                                 | NFR-01, NFR-03 | unit-тесты delete                    | High      |
| API (общ.)        | I                    | Подробные ошибки пользователю      | RFC7807/структурированные ошибки, скрывать stacktrace                 | NFR-02         | Контрактный тест 4xx/5xx             | Medium    |
| Edge -> Core (F6)  | T/E                  | Подмена файла БД/порча             | Права на файл БД, резервная копия (бэкап)                             | NFR-08         | Скрипт бэкапа/права FS               | Medium    |
| CI/CD             | E                    | Уязвимые пакеты                    | pip-audit в CI, обновление зависимостей                               | NFR-06         | Лог шага pip-audit в Actions         | Medium    |
| F2 GET /items     | D (DoS)              | Подвисание/исчерпание воркеров при зависании внешних вызовов | Таймауты (connect/read/total) + ретраи ≤2 с backoff | NFR-11        | unit-тесты на таймаут/ретраи, логи метрик | High      |
